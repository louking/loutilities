###########################################################################################
#   nesteddict - dotted[k1.k2.k3] into nested[k1][k2][k3]
#
#   Date        Author      Reason
#   ----        ------      ------
#   10/04/18    Lou King    create
#
#   Copyright 2018 Lou King
###########################################################################################

#----------------------------------------------------------------------
def dotted2nested_set(d, key, value):
#----------------------------------------------------------------------
    '''
    if key is in dotted notation, turn into nested dict
    e.g., dotted['k1.k2.k3'] into nested['k1']['k2']['k3']
    '''
    keysplit = key.split('.')
    if len(keysplit) == 1:
        d[key] = value
    else:
        if keysplit[0] not in d:
            d[keysplit[0]] = {}
        dotted2nested_set(d[keysplit[0]], '.'.join(keysplit[1:]), value)

#----------------------------------------------------------------------
def dotted2nested_get(d, key):
#----------------------------------------------------------------------
    '''
    if key is in dotted notation, turn into nested dict
    e.g., dotted['k1.k2.k3'] into nested['k1']['k2']['k3']
    '''
    keysplit = key.split('.')
    if len(keysplit) == 1:
        return d[key]
    else:
        return dotted2nested_get(d[keysplit[0]], '.'.join(keysplit[1:]))

###########################################################################################
class NestedDict(dict):
###########################################################################################

    #----------------------------------------------------------------------
    def __init__(self):
    #----------------------------------------------------------------------
        self.val = {}

    #----------------------------------------------------------------------
    def __setitem__(self, key, val):
    #----------------------------------------------------------------------
        dotted2nested_set(self.val, key, val)

    #----------------------------------------------------------------------
    def __getitem__(self, key):
    #----------------------------------------------------------------------
        return dotted2nested_get(self.val, key)

    #----------------------------------------------------------------------
    def to_dict(self):
    #----------------------------------------------------------------------
        return self.val

